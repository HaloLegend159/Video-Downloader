<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Video Link Viewer</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 24px; max-width: 900px; }
    .row { display: flex; gap: 8px; flex-wrap: wrap; }
    input { flex: 1; min-width: 280px; padding: 10px; font-size: 16px; }
    button { padding: 10px 14px; font-size: 16px; cursor: pointer; }
    .card { margin-top: 16px; padding: 14px; border: 1px solid #ddd; border-radius: 12px; }
    .hint { color: #666; font-size: 14px; margin-top: 8px; }
    iframe { width: 100%; aspect-ratio: 16/9; border: 0; border-radius: 12px; }
    video { width: 100%; border-radius: 12px; background: #000; }
    .meta { display: grid; gap: 6px; margin-top: 10px; }
    .thumb { max-width: 240px; border-radius: 10px; border: 1px solid #eee; }
    .error { color: #b00020; }
  </style>
</head>
<body>
  <h1>Video Link Viewer</h1>
  <p class="hint">
    Paste a link. If it’s YouTube/Vimeo/etc., this will embed it. If it’s a direct .mp4/.webm/.m3u8 URL you control, it will play it.
  </p>

  <div class="row">
    <input id="url" placeholder="https://…" autocomplete="off" />
    <button id="go">Load</button>
    <button id="clear">Clear</button>
  </div>

  <div id="out" class="card" style="display:none;"></div>

  <script>
    const $ = (id) => document.getElementById(id);
    const out = $("out");

    function isDirectVideoFile(u) {
      const path = u.pathname.toLowerCase();
      return (
        path.endsWith(".mp4") ||
        path.endsWith(".webm") ||
        path.endsWith(".ogg") ||
        path.endsWith(".m3u8") // HLS manifest
      );
    }

    function youTubeEmbed(url) {
      // supports youtu.be/<id> and youtube.com/watch?v=<id>
      const host = url.hostname.replace(/^www\./, "");
      let id = null;

      if (host === "youtu.be") id = url.pathname.slice(1);
      if (host === "youtube.com" || host === "m.youtube.com") id = url.searchParams.get("v");

      // also support /shorts/<id>
      if (!id && (host === "youtube.com" || host === "m.youtube.com")) {
        const parts = url.pathname.split("/").filter(Boolean);
        if (parts[0] === "shorts" && parts[1]) id = parts[1];
      }

      if (!id) return null;
      return `https://www.youtube-nocookie.com/embed/${encodeURIComponent(id)}`;
    }

    function vimeoEmbed(url) {
      const host = url.hostname.replace(/^www\./, "");
      if (host !== "vimeo.com") return null;
      const id = url.pathname.split("/").filter(Boolean)[0];
      if (!id || !/^\d+$/.test(id)) return null;
      return `https://player.vimeo.com/video/${id}`;
    }

    function tryKnownEmbeds(url) {
      return youTubeEmbed(url) || vimeoEmbed(url) || null;
    }

    async function tryOEmbed(urlStr) {
      // Not all providers support unauthenticated oEmbed, and some block CORS.
      // We try a couple common ones:
      const providers = [
        // YouTube oEmbed supports CORS in most cases
        (u) => `https://www.youtube.com/oembed?format=json&url=${encodeURIComponent(u)}`,
        // Vimeo oEmbed
        (u) => `https://vimeo.com/api/oembed.json?url=${encodeURIComponent(u)}`
      ];

      for (const make of providers) {
        const endpoint = make(urlStr);
        try {
          const res = await fetch(endpoint);
          if (!res.ok) continue;
          return await res.json();
        } catch {
          // ignore and try next
        }
      }
      return null;
    }

    async function load() {
      const raw = $("url").value.trim();
      out.style.display = "block";
      out.innerHTML = "";

      let url;
      try {
        url = new URL(raw);
      } catch {
        out.innerHTML = `<p class="error">That doesn’t look like a valid URL.</p>`;
        return;
      }

      // 1) Direct video file? Use <video>
      if (isDirectVideoFile(url)) {
        // NOTE: Cross-origin servers must allow it, otherwise the browser may block playback.
        out.innerHTML = `
          <h2>Direct Video</h2>
          <video controls playsinline src="${url.toString()}"></video>
          <p class="hint">If playback fails, the host may block cross-origin use or require auth.</p>
        `;
        return;
      }

      // 2) Known platform? Use embed
      const embed = tryKnownEmbeds(url);
      if (embed) {
        out.innerHTML = `
          <h2>Embedded Player</h2>
          <iframe
            src="${embed}"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
            referrerpolicy="strict-origin-when-cross-origin"
          ></iframe>
          <div id="meta" class="meta"></div>
        `;

        // Optional: show metadata via oEmbed
        const meta = await tryOEmbed(url.toString());
        if (meta) {
          const metaDiv = document.getElementById("meta");
          metaDiv.innerHTML = `
            <div><strong>Title:</strong> ${escapeHtml(meta.title || "—")}</div>
            <div><strong>Author:</strong> ${escapeHtml(meta.author_name || "—")}</div>
            <div><strong>Provider:</strong> ${escapeHtml(meta.provider_name || "—")}</div>
            ${meta.thumbnail_url ? `<img class="thumb" src="${meta.thumbnail_url}" alt="thumbnail">` : ""}
          `;
        }
        return;
      }

      // 3) Fallback: we won't “extract” video. Just show a safe message.
      out.innerHTML = `
        <h2>Unsupported Link Type</h2>
        <p>
          This page supports embedding (YouTube/Vimeo) and direct video files (.mp4/.webm/.m3u8).
          It does not extract/download videos from general websites.
        </p>
      `;
    }

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, (c) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }

    $("go").addEventListener("click", load);
    $("clear").addEventListener("click", () => {
      $("url").value = "";
      out.style.display = "none";
      out.innerHTML = "";
    });

    $("url").addEventListener("keydown", (e) => {
      if (e.key === "Enter") load();
    });
  </script>
</body>
</html>
